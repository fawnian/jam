<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Jam & Cuaca — PWA Anti Burn‑in</title>
  <link id="gf-link" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap">
  <style>
    :root{
      --bg-dark:#000000; --fg-dark:#cbd5e1;
      --bg-light:#fafafa; --fg-light:#0f172a;
      --c-peach:#eab8a7; --c-rose:#c78b8d; --c-slate:#475a6a; --c-colon:#6b5b4d; --info:#9aa5b1;
      --radius:22px;
      /* adjustable sizes */
      --clock-size: min(28vw, 34vh);
      --meta-size: min(5.4vw, 3.8vh);
      --date-size: min(5.4vw, 3.8vh);
    }

    [data-theme="dark"]{ --bg:var(--bg-dark); --fg:var(--fg-dark); }
    [data-theme="light"]{ --bg:var(--bg-light); --fg:var(--fg-light); }

    html,body{height:100%;}
    body{ margin:0; background:var(--bg); color:var(--fg); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", sans-serif; overflow:hidden; }

    .stage{position:relative; width:100%; height:100%;}
    .floating{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); will-change:transform;}

    .clock{display:flex; align-items:center; gap:min(2vw,18px);}    
    .block{position:relative; line-height:0.9;}
    .digit{ font-weight:900; font-size: var(--clock-size); letter-spacing:-0.04em; opacity:0.95; animation: breathe 8s ease-in-out infinite; }
    .d0{color:var(--c-peach)} .d1{color:var(--c-rose)} .d2,.d3{color:var(--c-slate)}

    .colon-wrap{position:relative; width:min(8vw,9vh);} 
    .dot{position:absolute; left:50%; transform:translateX(-50%); width:min(4.8vw,5.6vh); height:min(4.8vw,5.6vh); border-radius:50%; background:var(--c-colon); opacity:0.72; mix-blend-mode:multiply;}
    .dot.top{top:12%;} .dot.bot{bottom:10%;}

    .meta{ margin-top:min(2vh,20px); display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; font-size:var(--meta-size); opacity:0.98; }
    .wx{ display:inline-flex; gap:8px; align-items:center; }
    .wx svg{ width:1.2em; height:1.2em; }
    .sep{ opacity:0.55; }
    .date{ font-size:var(--date-size); }

    .controlbar{ position:fixed; right:10px; bottom:10px; display:flex; gap:10px; z-index:10; pointer-events:auto; }
    .btn{ background:rgba(255,255,255,0.06); color:var(--fg); border:1px solid rgba(255,255,255,0.18); padding:10px 14px; border-radius:999px; font-size:14px; backdrop-filter: blur(4px); opacity:0.8; }
    .btn:active{opacity:1}

    .modal{ position:fixed; inset:0; background:rgba(0,0,0,0.55); display:none; align-items:center; justify-content:center; z-index:30; }
    .sheet{ background:var(--bg); color:var(--fg); width:min(760px, 96vw); max-height:90vh; overflow:auto; border-radius:var(--radius); border:1px solid rgba(255,255,255,0.14); padding:18px; }
    .sheet h2{ margin:0 0 12px 0; font-size:18px; }
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field label{ font-size:13px; opacity:0.75; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .field input[type="text"], .field select, .field input[type="number"], .field input[type="range"]{ padding:10px; background:transparent; color:var(--fg); border:1px solid rgba(255,255,255,0.2); border-radius:10px; }
    .field input[type="color"]{ width:48px; height:36px; border-radius:8px; border:1px solid #555; background:none; }
    .actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:8px; }

    @keyframes breathe{ 0%,100%{filter:brightness(1)} 50%{filter:brightness(1.06)} }
  </style>
</head>
<body data-theme="dark">
  <div class="stage" id="stage">
    <div class="floating" id="float">
      <div class="clock" aria-label="Jam saat ini">
        <div class="block"><span id="h1" class="digit d0">0</span><span id="h2" class="digit d1">0</span></div>
        <div class="colon-wrap" aria-hidden="true"><span class="dot top"></span><span class="dot bot"></span></div>
        <div class="block"><span id="m1" class="digit d2">0</span><span id="m2" class="digit d3">0</span></div>
      </div>
      <div class="meta">
        <span class="wx" id="wx"><span id="wxIcon"></span><span id="wxText">—</span></span>
        <span class="sep">•</span>
        <span class="date" id="dateText">—</span>
      </div>
    </div>
  </div>

  <div class="controlbar">
    <button class="btn" id="btnFS">⛶ Fullscreen</button>
    <button class="btn" id="btnSettings">⚙️ Pengaturan</button>
  </div>

  <div class="modal" id="modal">
    <div class="sheet">
      <h2>Pengaturan Jam & Cuaca</h2>
      <div class="grid">
        <div class="field">
          <label>Mode Tema</label>
          <div class="row">
            <label><input type="radio" name="theme" value="dark"> Gelap</label>
            <label><input type="radio" name="theme" value="light"> Terang</label>
          </div>
        </div>

        <div class="field">
          <label>Format Waktu</label>
          <div class="row">
            <label><input type="radio" name="tf" value="24"> 24 jam</label>
            <label><input type="radio" name="tf" value="12"> 12 jam</label>
          </div>
        </div>

        <div class="field">
          <label>Ukuran Huruf</label>
          <div class="row">
            <span>Jam</span><input id="sizeClock" type="range" min="14" max="40" value="28">
            <span>Cuaca</span><input id="sizeMeta" type="range" min="3" max="10" value="5.4" step="0.1">
            <span>Tanggal</span><input id="sizeDate" type="range" min="3" max="10" value="5.4" step="0.1">
          </div>
          <small>Nilai dalam vw (portrait) dengan adaptasi otomatis di landscape.</small>
        </div>

        <div class="field">
          <label>Font Google</label>
          <div class="row">
            <select id="fontPick">
              <option>Inter</option><option>Poppins</option><option>Montserrat</option><option>Rubik</option><option>Nunito</option><option>Roboto</option><option>Work Sans</option><option>Mulish</option>
            </select>
            <input id="fontCustom" type="text" placeholder="atau ketik nama font lain (Google Fonts)">
          </div>
        </div>

        <div class="field">
          <label>Warna Digit & Teks</label>
          <div class="row">
            <span>0:</span><input type="color" id="cPeach" value="#eab8a7">
            <span>9:</span><input type="color" id="cRose" value="#c78b8d">
            <span>4/1:</span><input type="color" id="cSlate" value="#475a6a">
            <span>Titik dua:</span><input type="color" id="cColon" value="#6b5b4d">
            <span>Teks:</span><input type="color" id="cInfo" value="#9aa5b1">
          </div>
        </div>

        <div class="field">
          <label>Format Hari & Tanggal</label>
          <select id="dateFmt">
            <option value="long">EEEE, d MMMM yyyy</option>
            <option value="short">EEE, dd/MM/yyyy</option>
            <option value="iso">yyyy-MM-dd</option>
          </select>
        </div>

        <div class="field">
          <label>Cuaca — Sumber Lokasi</label>
          <div class="row">
            <label><input type="radio" name="locmode" value="gps"> GPS</label>
            <label><input type="radio" name="locmode" value="manual"> Manual (koordinat)</label>
          </div>
        </div>
        <div class="row">
          <div class="field" style="flex:1; min-width:160px">
            <label>Latitude (manual)</label>
            <input id="lat" type="number" step="0.000001" placeholder="-6.2">
          </div>
          <div class="field" style="flex:1; min-width:160px">
            <label>Longitude (manual)</label>
            <input id="lon" type="number" step="0.000001" placeholder="106.8">
          </div>
          <div class="field" style="flex:1; min-width:160px">
            <label>Unit Suhu</label>
            <select id="units">
              <option value="metric">°C</option>
              <option value="imperial">°F</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="btnInstall">➕ Install ke Layar Utama</button>
          <span style="flex:1"></span>
          <button class="btn" id="btnClose">Tutup</button>
          <button class="btn" id="btnSave">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // ---------- STATE ----------
    var state = {
      theme:'dark', units:'metric', font:'Inter', timeFormat:'24',
      colors:{peach:'#eab8a7',rose:'#c78b8d',slate:'#475a6a',colon:'#6b5b4d',info:'#9aa5b1'},
      locmode:'gps', lat:null, lon:null,
      sizes:{clockVW:28, metaVW:5.4, dateVW:5.4},
      dateFmt:'long'
    };
    try{var s=localStorage.getItem('cw3_settings'); if(s) state=Object.assign(state, JSON.parse(s));}catch(e){}
    function save(){try{localStorage.setItem('cw3_settings', JSON.stringify(state));}catch(e){}}

    // ---------- APPLY THEME / FONT / COLORS / SIZES ----------
    function $(q){return document.querySelector(q)}
    function applyTheme(){ document.body.setAttribute('data-theme', state.theme); }
    function loadGoogleFont(name){ if(!name) return; var fam=name.replace(/ /g,'+'); $('#gf-link').href='https://fonts.googleapis.com/css2?family='+encodeURIComponent(fam)+':wght@400;700;900&display=swap'; document.body.style.fontFamily = name + ', Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", sans-serif'; }
    function applyColors(){ var r=document.documentElement.style; r.setProperty('--c-peach',state.colors.peach); r.setProperty('--c-rose',state.colors.rose); r.setProperty('--c-slate',state.colors.slate); r.setProperty('--c-colon',state.colors.colon); r.setProperty('--info',state.colors.info); }
    function applySizes(){ var r=document.documentElement.style; r.setProperty('--clock-size','min('+state.sizes.clockVW+'vw, '+ Math.round(state.sizes.clockVW*1.2) +'vh)'); r.setProperty('--meta-size', 'min('+state.sizes.metaVW+'vw, '+ Math.round(state.sizes.metaVW*0.7) +'vh)'); r.setProperty('--date-size', 'min('+state.sizes.dateVW+'vw, '+ Math.round(state.sizes.dateVW*0.7) +'vh)'); }
    applyTheme(); loadGoogleFont(state.font); applyColors(); applySizes();

    // ---------- CLOCK ----------
    function pad(n){return (n<10?'0':'')+n}
    function tick(){ var d=new Date(); var h=d.getHours(); if(state.timeFormat==='12'){ h = h%12; if(h===0) h=12; } var hh = pad(h); var mm=pad(d.getMinutes()); $('#h1').textContent=hh[0]; $('#h2').textContent=hh[1]; $('#m1').textContent=mm[0]; $('#m2').textContent=mm[1]; renderDate(); }
    tick(); setInterval(tick,1000);

    // Anti burn-in wander
    var floatEl=$('#float'); function wander(){ var x=(Math.random()*16-8), y=(Math.random()*14-7); floatEl.style.transform='translate(calc(-50% + '+x+'%), calc(-50% + '+y+'%))'; } setInterval(wander,20000); setTimeout(wander,1200);

    // ---------- DATE LINE ----------
    function renderDate(){ var d=new Date(); var fmt=state.dateFmt; var text=''; var locale='id-ID'; if(fmt==='iso'){ text = d.getFullYear()+ '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate()); } else if(fmt==='short'){ text = new Intl.DateTimeFormat(locale,{weekday:'short', day:'2-digit', month:'2-digit', year:'numeric'}).format(d); } else { text = new Intl.DateTimeFormat(locale,{weekday:'long', day:'numeric', month:'long', year:'numeric'}).format(d); } $('#dateText').textContent=text; }
    renderDate();

    // ---------- WEATHER ----------
    var wxEl=$('#wxText'), iconEl=$('#wxIcon');
    function getJSON(url,cb){ if(window.fetch){ fetch(url).then(r=>r.json()).then(j=>cb(null,j)).catch(e=>cb(e)); } else { var x=new XMLHttpRequest(); x.open('GET',url,true); x.onreadystatechange=function(){ if(x.readyState===4){ try{cb(null,JSON.parse(x.responseText))}catch(e){cb(e)} } }; x.send(); } }
    function codeToText(code){ var m={0:'Cerah',1:'Sebagian berawan',2:'Berawan',3:'Mendung',45:'Berkabut',48:'Embun beku',51:'Gerimis ringan',53:'Gerimis',55:'Gerimis lebat',61:'Hujan ringan',63:'Hujan',65:'Hujan lebat',71:'Salju',80:'Hujan sesaat',95:'Badai Petir'}; return m[code]||'Cuaca'; }
    function iconSVG(code){
      var c='currentColor';
      if(code===0){return '<svg viewBox="0 0 24 24" fill="none" stroke="'+c+'" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v3M12 20v3M1 12h3M20 12h3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M4.2 19.8l2.1-2.1M17.7 6.3l2.1-2.1"/></svg>';}
      if(code>=1 && code<=3){return '<svg viewBox="0 0 24 24" fill="'+c+'"><path d="M8 18h9a5 5 0 0 0 0-10 6 6 0 0 0-11-2 5 5 0 0 0 2 12z"/></svg>';}
      if((code>=51&&code<=65) || code===80){return '<svg viewBox="0 0 24 24" fill="none" stroke="'+c+'" stroke-width="2"><path d="M7 18h9a5 5 0 0 0 0-10 6 6 0 0 0-11-2 5 5 0 0 0 2 12z"/><path d="M8 20l1 2M12 20l-1 2M16 20l1 2"/></svg>';}
      if(code>=95){return '<svg viewBox="0 0 24 24" fill="none" stroke="'+c+'" stroke-width="2"><path d="M7 18h9a5 5 0 0 0 0-10 6 6 0 0 0-11-2 5 5 0 0 0 2 12z"/><path d="M12 13l-2 3h3l-2 3"/></svg>';}
      return '<svg viewBox="0 0 24 24" fill="'+c+'"><circle cx="12" cy="12" r="4"/></svg>';
    }
    function renderWeather(j){ try{ var temp=(j.current&&j.current.temperature_2m)||(j.current_weather&&j.current_weather.temperature); var code=(j.current&&j.current.weather_code)||(j.current_weather&&j.current_weather.weathercode); var unit=(state.units==='metric')?'°C':'°F'; iconEl.innerHTML=iconSVG(code); wxEl.textContent= Math.round(temp)+unit+' · '+codeToText(code); }catch(e){ wxEl.textContent='Cuaca tidak tersedia'; iconEl.innerHTML=''; } }
    function byCoords(lat,lon){ var url='https://api.open-meteo.com/v1/forecast?latitude='+lat+'&longitude='+lon+'&current=temperature_2m,weather_code&timezone=auto'+(state.units==='imperial'?'&temperature_unit=fahrenheit':''); getJSON(url,function(err,j){ if(err){ wxEl.textContent='Gagal memuat cuaca'; iconEl.innerHTML=''; return;} renderWeather(j); }); }
    function loadWeather(){ if(state.locmode==='manual' && state.lat!=null && state.lon!=null){ byCoords(state.lat,state.lon); return;} if(!navigator.geolocation){ wxEl.textContent='Atur koordinat manual di Pengaturan'; iconEl.innerHTML=''; return;} navigator.geolocation.getCurrentPosition(function(p){ byCoords(p.coords.latitude,p.coords.longitude); }, function(){ wxEl.textContent='Izin lokasi ditolak — gunakan koordinat manual.'; iconEl.innerHTML=''; }, {maximumAge:1800000, timeout:8000}); }
    loadWeather(); setInterval(loadWeather,10*60*1000);

    // ---------- FULLSCREEN ----------
    function goFull(){ var el=document.documentElement; var r= el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen||el.mozRequestFullScreen; if(r) r.call(el); }
    document.getElementById('btnFS').addEventListener('click', goFull);

    // ---------- SETTINGS UI ----------
    function openModal(){ document.getElementById('modal').style.display='flex'; syncForm(); }
    function closeModal(){ document.getElementById('modal').style.display='none'; }
    document.getElementById('btnSettings').addEventListener('click', openModal); document.getElementById('btnClose').addEventListener('click', closeModal);

    function syncForm(){
      Array.prototype.forEach.call(document.querySelectorAll('input[name="theme"]'), function(r){ r.checked=(r.value===state.theme); });
      Array.prototype.forEach.call(document.querySelectorAll('input[name="tf"]'), function(r){ r.checked=(r.value===state.timeFormat); });
      document.getElementById('sizeClock').value = state.sizes.clockVW; document.getElementById('sizeMeta').value = state.sizes.metaVW; document.getElementById('sizeDate').value = state.sizes.dateVW;
      document.getElementById('fontPick').value = state.font || 'Inter'; document.getElementById('fontCustom').value='';
      document.getElementById('cPeach').value=state.colors.peach; document.getElementById('cRose').value=state.colors.rose; document.getElementById('cSlate').value=state.colors.slate; document.getElementById('cColon').value=state.colors.colon; document.getElementById('cInfo').value=state.colors.info;
      document.getElementById('dateFmt').value = state.dateFmt;
      Array.prototype.forEach.call(document.querySelectorAll('input[name="locmode"]'), function(r){ r.checked=(r.value===state.locmode); });
      document.getElementById('lat').value = state.lat!=null?state.lat:''; document.getElementById('lon').value = state.lon!=null?state.lon:''; document.getElementById('units').value=state.units;
    }

    function normalizeFontName(name){ return (name||'').trim().replace(/\s+/g,' '); }

    document.getElementById('btnSave').addEventListener('click', function(){
      state.theme = document.querySelector('input[name="theme"]:checked').value; applyTheme();
      state.timeFormat = document.querySelector('input[name="tf"]:checked').value;
      state.sizes.clockVW = parseFloat(document.getElementById('sizeClock').value); state.sizes.metaVW = parseFloat(document.getElementById('sizeMeta').value); state.sizes.dateVW = parseFloat(document.getElementById('sizeDate').value); applySizes();
      var fcustom=normalizeFontName(document.getElementById('fontCustom').value); var fname = fcustom || document.getElementById('fontPick').value; state.font=fname; loadGoogleFont(fname);
      state.colors.peach=document.getElementById('cPeach').value; state.colors.rose=document.getElementById('cRose').value; state.colors.slate=document.getElementById('cSlate').value; state.colors.colon=document.getElementById('cColon').value; state.colors.info=document.getElementById('cInfo').value; applyColors();
      state.dateFmt = document.getElementById('dateFmt').value; renderDate();
      state.locmode = document.querySelector('input[name="locmode"]:checked').value; var latVal=document.getElementById('lat').value; var lonVal=document.getElementById('lon').value; state.lat = latVal===''?null:parseFloat(latVal); state.lon = lonVal===''?null:parseFloat(lonVal); state.units=document.getElementById('units').value; save(); loadWeather(); closeModal();
    });

    // ---------- PWA (Install) ----------
    function makeIcon(size){ var c=document.createElement('canvas'); c.width=c.height=size; var g=c.getContext('2d'); g.fillStyle=(state.theme==='light')?'#111':'#000'; g.fillRect(0,0,size,size); g.fillStyle=(state.theme==='light')?'#0f172a':'#e5e7eb'; g.font=Math.floor(size*0.58)+'px 900 Inter'; g.textAlign='center'; g.textBaseline='middle'; g.fillText('09', size*0.48, size*0.50); return c.toDataURL('image/png'); }
    function attachManifest(){ var manifest={ name:'Jam & Cuaca', short_name:'JamCuaca', start_url:'.', display:'standalone', background_color:getComputedStyle(document.body).getPropertyValue('--bg').trim()||'#000000', theme_color:(state.theme==='light')?'#fafafa':'#000000', icons:[192,256,384,512].map(function(s){return{src:makeIcon(s),sizes:s+'x'+s,type:'image/png'};}) }; var blob=new Blob([JSON.stringify(manifest)],{type:'application/json'}); var url=URL.createObjectURL(blob); var link=document.createElement('link'); link.rel='manifest'; link.href=url; document.head.appendChild(link);} attachManifest();
    function registerSW(){ if(!('serviceWorker' in navigator)) return; var code='self.addEventListener(\'install\',e=>{e.waitUntil(caches.open(\'cw3-v1\').then(c=>c.addAll([\'./\'])))});self.addEventListener(\'fetch\',e=>{e.respondWith(caches.match(e.request).then(r=> r || fetch(e.request)));});'; var blob=new Blob([code],{type:'text/javascript'}); var url=URL.createObjectURL(blob); navigator.serviceWorker.register(url).catch(function(){}); } registerSW();

    var deferredPrompt=null; var installBtn=document.getElementById('btnInstall');
    window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); deferredPrompt=e; installBtn.style.display=''; });
    installBtn.addEventListener('click', function(){ if(!deferredPrompt) return; deferredPrompt.prompt(); deferredPrompt.userChoice.finally(function(){ deferredPrompt=null; installBtn.style.display='none'; }); });

  })();
  </script>
</body>
</html>